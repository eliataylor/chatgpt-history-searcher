<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thread Search</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>
<body>

<div class="container mt-4">
    <h1>Thread Search</h1>

    <div class="form-group">
        <label for="dataTextarea">Paste Data:</label>
        <textarea class="form-control" id="dataTextarea" rows="5"></textarea>
    </div>

    <div class="form-group">
        <label for="tokenInput">Bearer Token:</label>
        <input type="text" class="form-control" id="tokenInput" placeholder="Enter Bearer Token...">
    </div>

    <button class="btn btn-primary" onclick="fetchDetails()">Fetch Details</button>

    <div id="results" class="mt-4"></div>
</div>

<script>
    // Example data
    const threadsData = [
        { index: 1, title: "Thread One", link: "http://example.com/thread1" },
        { index: 2, title: "Thread Two", link: "http://example.com/thread2" },
        // Add more threads as needed
    ];

    function fetchDetails() {
        const data = $('#dataTextarea').val();
        const links = extractLinksFromData(data);
        const bearerToken = $('#tokenInput').val();

        // Request details for each link with the provided token
        const linkScraper = new LinkScraper('body', 'a', 500, bearerToken);
        linkScraper.requestLinkDetails(links).then(details => {
            displayResults(details);
        });
    }

    function extractLinksFromData(data) {
        const linkRegex = /https?:\/\/[^\s]+/g;
        return data.match(linkRegex) || [];
    }

    function displayResults(details) {
        const resultsContainer = $('#results');
        resultsContainer.html('');

        if (details.length === 0) {
            resultsContainer.html('<p>No details found.</p>');
        } else {
            details.forEach(detail => {
                const resultElement = $('<div class="card mt-2">');
                resultElement.append(`<div class="card-body"><h5 class="card-title">${detail.title}</h5><p class="card-text">${detail.link}</p><p class="card-text">${detail.messages}</p><p class="card-text">${detail.created}</p></div>`);
                resultsContainer.append(resultElement);
            });
        }
    }

    class LinkScraper {
        constructor(containerSelector, linkSelector, waitTime, bearerToken) {
            this.containerSelector = containerSelector;
            this.linkSelector = linkSelector;
            this.waitTime = waitTime;
            this.bearerToken = bearerToken;
        }

        async requestLinkDetails(links) {
            const requests = links.map(link => this.fetchLinkDetails(link));
            const responses = await Promise.all(requests);

            // Combine details with original threadsData
            const details = responses.map((response, index) => ({
                ...threadsData[index],
                messages: response.messages,
                created: response.created
            }));

            return details;
        }

        async fetchLinkDetails(link) {
            // Simulate an Ajax request (replace this with your actual API endpoint)
            const response = await $.ajax({
                url: 'https://jsonplaceholder.typicode.com/posts/1', // Example URL
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${this.bearerToken}`
                }
            });

            return {
                messages: response.title, // Example: use the 'title' property from the response
                created: response.body // Example: use the 'body' property from the response
            };
        }
    }
</script>

</body>
</html>
